# ch05. 데이터 통합 (Generalization)

## 5.1 데이터 통합

- `유사한 성격의 데이터`를 더 큰 주제로 합치는 것

**동질성을 가진 데이터의 판단 기준?** 
  - `데이터의 성격`
  - 따라서 속성과 엔티티에 대한 명확한 이해가 선행조건
  - ⭐️ **정규화(엔티티에 대한 명확한 정의)를 끝낸 다음에 데이터 통합해야함** 

**`데이터 통합` 왜 해야할까? 🤔**
- 확장성이 좋은 유연한 모델을 만드는 데 사용되는 주요한 기법
- 미래에 어떤 업무가 발생할지 예상할 수는 없지만, **모델을 어떻게 구축해야 추가, 변경 업무를 더욱 수월하게 반영할 수 있는지를 판단할 수 있음**
- 많은 경험과 데이터에 대한 이해력이 필요함
- **그러나 상식적인 선에서 판단해도 알 수 있을 때가 많음**

c.f.
- `정규화`: 반복 속성을 별도의 엔티티로 정규화함으로써 일반화하여 확장성 고려
- `데이터 통합`: 미래의 확장성에 초점을 맞춘다는 관점에서 확장성 고려 

**`정규화 -> 데이터 통합 -> 비정규화` 순서**
- 비정규화를 수행하고 나서 엔티티를 통합하면 의미가 희석돼 정확히 통합하기가 어려워짐
- 왜?
  - 비정규형은 중복 데이터를 채택한 모델이므로 기본적으로 데이터 성격을 명확하게 반영한 모델이 아니기 때문. 

**데이터 통합과 비정규화 차이점?**
- 데이터 통합: 
  - 확장성을 높이고자 데이터를 일반화시키는 것
  - 중복 데이터가 늘어나지 않음
  - 조회 성능 개선이 목적이 아님 (물론 좋아질 때가 많음)
- 비정규화:
  - 성능 개선이 주 목적
  - 중복 데이터가 늘어나며 모델의 확장성을 높여주지 않음

**핵심적인 업무일 수록 데이터 일반화가 필요함**
- 핵심적인 업무? 요구사항 변경, 추가 가능성이 높음
- 가까운 미래에 추가될 업무가 있는지에 대한 담당자 의견을 참조하여 데이터 일반화를 결정
- 미래의 작업을 줄일 수 있도록 현재 고민하는 것은 가치있음

> ‼️ **핵심적인 업무를 수행하는 중요한 엔티티는 데이터 성격 기반으로 통합하여 견고하면서 유연한 모델을 구축해야 함**

**엔티티 통합 시 주의할 점**
- 모델의 확장성을 고려하는 데 의미를 둘 수도 있지만 **실익이 있는지**를 따져봐야 한다.
- 엔티티를 통합하면 데이터는 많아질 수 밖에 없음. **성능은 항상 세심하게 고려**할 것
  - 정말로 성능상 문제가 발생하는지에 대한 접근 + 문제 여지가 있다면 어떻게 해결해야하는가
- 실체 엔티티는 최대한 통합, 행위 엔티티는 가능한 통합
  - 실체, 행위, 기준 엔티티 간에는 통합하면 안됨

**엔티티 통합 시점**
- 핵심 엔티티: 개념 모델에서 통합이 논의돼 도출
- 일반적인 엔티티: 논리 모델링 단계에서 통합 작업을 수행

**프로젝트 규모가 커질수록 엔티티 통합 작업 필요**
- 점차 없어서는 안 될 필수적인 연관관계만을 파악하고 효율적인 연관 관계에 대해서는 관심을 두지 않게 됨
- ‼️ **비슷한 종류의 엔티티가 여러 영역에 존재하여 중복 개발이 뒤따르고 중복 데이터 관리의 어려움 발생**

**데이터는 기업 전체의 공동 자산**
- 데이터 모델은 개발 영역과 무관하게, **전사적인 데이터 관점에서 공유 필요**
- 개발 담당자는 여러 주제 영역에 존재하는 데이터를 보고 자신의 영역을 개발하면 됨

---

## 5.2 데이터 통합의 장단점

### 장점
**확장성 제고** (업무 변화에 유연한 대처 및 신속한 대응 가능)
- 정규형은 수학적 기법에 따라 기계적으로 이루어진다면, 데이터 통합은 경험과 종합적 판단력에 따라 이루어짐
- 왜 확장성 좋아질까?
  - 비슷한 유형의 업무가 발생했을 때 별도의 엔티티나 관계의 추가 없이 **속성이나 속성 값을 추가해서 처리 가능**
  - 엔티티 별로 애플리케이션 개발이 필요 없어서 유지, 보수가 쉬워지며 중복 개발 방지 가능

**하위 엔티티에 배타 관계를 발생시키지 않게 됨**
- 배타 관계는 모델 및 액세스 경로를 복잡하게 만듦 -> 조회 효율성 저하
  - e.g. UNION 등 복잡한 SQL 유발
- 따라서 배타 관계를 없애는 것은 데이터베이스에 실질적인 도움을 줌

**데이터 모델이 단순해짐**
- 좋은 모델 == 단순한 모델
- 엔티티가 단순 -> 관계 단순 -> 가독성 향상
- 유사한 성격의 데이터가 통합돼 슈퍼타입, 서브타입으로 표현되면 사용자가 데이터의 성격을 이해하기 수월해짐

### 단점
정규화와 달리, **명확한 기준이 없음**
- 마음대로 통합할 수 있기 때문에, 남용되는 사례가 많음
- 유사하지 않은 데이터를 무리하게 통합하지 않아야 함

**데이터가 변질될 수 있음**
- 데이터가 변질될 정도로 통합되는 예는 드묾
- 데이터가 변질돼 성격이 희석되는 현상은 오히려 엔티티 정의를 명확하게 하지 못한 데서 기인함

> ‼️ 데이터를 통합 선행 조건: 통합하려는 대상을 분명하게 정의하는 것 -> 앞으로 어떻게 확장될 수 있을 지 추측 (확정되지 않은 미래가 중심이 돼서도 안됨)

**일정 범위를 넘으면 업무가 제대로 보이지 않음**
- 데이터를 일반화시키면 상세 내용은 묻힘
  - e.g. 외국인 고객 데이터가 고객 엔티티에 통합되었는지, 해지일자가 처리일자 속성에 통합되었는지 등 알기 어려움

**데이터베이스 성능과 관리 측면**
- 하지만 성능엔 아무런 영향을 미치지 않거나 조회 성능이 훨씬 좋아지는 경우가 많음
  - e.g. 통합된 엔티티에 파티션을 적용하면 테이블 풀 스캔도 피할 수 있고, 사실상 개별 엔티티와 같아서 성능 저하를 논하기 어려움
- 하지만 데이터가 증가해서 인덱스의 깊이가 깊어지고 널 값이 많이 사용되는 단점은 존재
- 데이터가 커지는 것을 기피하기보단, 대용량 데이터에 대한 관리 방안을 마련하는 것이 현명함
- 마이그레이션도 이슈

**데이터 통합했을 때 발생하는 문제 < 통합하지 않았을 때 발생하는 문제**
- 개념 모델링 단계에선 데이터를 통합하는 것이 좋다.
- 논리 모델링 단계에서 상세하게 파악하면 서로 통합할 성격이 아니란 것이 판별될 수도 있음

> ‼️ 개념 모델링 단계에서 통합하지 않으면 논리 모델링 단계에서 통합을 심도 있게 고려하기 어려움 -> 결과적으로 통합될 가능성 저하

---

## 5.3 엔티티 통합 대상

**엔티티 통합 시점**
- 개념 모델링 단계에서 주로 이루어지며 **가능한 초반에 통합된 모습이 보이는 것이 좋음**
- 논리, 물리 모델링 단계에서도 엔티티 통합될 수 있음

**가장 기본적인 통합 대상**
- 엔티티를 구성하는 데이터의 성격이 유사할 때 
  - e.g. 주식을 거래하는 계좌, 선물옵션을 거래하는 계좌, 수익증권을 거래하는 계좌가 별도로 존재할 때
- 핵심적인 엔티티에서 주로 발생
  - e.g. 고객, 계좌, 상품 등
  - `계좌`, `고객 데이터`는 항상 통합 대상 1순위
- **기초 속성으로 데이터의 유사성을 판단해 통합을 고려하자**
- 일부 다른 속성이 존재한다면 **서브 타입으로 구분하자**

**주 식별자가 달라서 엔티티 통합이 어렵다면?**
- 인조식별자: 데이터 모델 유연하게 관리
- 업무 식별자: 복합 속성을 유니크 인덱스로 관리

**엔티티의 주 식별자가 동일할 때** 통합 대상
- `업무 식별자가 유사`하면 유사한 성격의 데이터
  - e.g. 주식종목, 선물옵션종목, CP종목 엔티티
- 인조 식별자가 주 식별자면 유사한 데이터 아닐 수 있음
- 종목 별로 관리되는 개별 속성이 공통 속성보다 많이 존재하므로 서브타입으로 개별 속성 관리
  - 개별 속성이 많다는 이유로 통합하지 않으면 추후 새로운 유형의 종목이 생길 때마다 엔티티가 늘어나게 됨
  - 이는 배타 관계 등 관계가 늘어나고 통합 조회 시 UNION 구문으로 인해 조회 복잡도 및 성능 문제가 발생해 프로그램 수정을 유발함
> ‼️ 최상위에 위치하는 핵심 엔티티는 통합된 모습으로 설계하는 것이 바람직함

**데이터 성격은 조금 다르지만 엔티티의 (기초) 속성이 유사한** 예도 통합 대상

**엔티티 사이에 계층 관계가 존재해도** 통합 대상

**배타 관계를 없애기 위해서는 배타 관계를 발생시킨 엔티티도** 통합 대상
- e.g. 거래내역 엔티티(핵심) - 주식종목, 채권종목, 선물옵션종목, 수익증권종목(배타 관계)
- 많이 조회되는 핵심 엔티티는 종목의 종류 별로 배타 관계가 발생하면 조인하기 불편하고 요건에 따라서는 성능에 치명적인 영향 발생
- 이럴 때 종목 엔티티로 통합하면 핵심 엔티티에는 배타 관계가 발생하지 않음
  - 주식종목, 채권종목, 선물옵션종목, 수익증권옵션 -> 종목 엔티티로 통합

**유사한 데이터지만 뷰의 형태로 엔티티가 별도로 존재**해도 데이터 통합 대상
- e.g. 상품월별매출, 상품별분기매출 엔티티는 집계 기간이 다른 통합 대상 엔티티
- 월별 매출액을 합하면 분기매출액임. 상품별분기매출 엔티티는 불필요
- 뷰가 달라서 데이터 별도 관리는 데이터 중복 및 무결성 차원에서 바람직하지 않음
- But 인스턴스가 지나치게 증가할 때는 통합하지 않는 것이 적합

> ‼️ 집계 데이터는 최대한 통합해 데이터 정합성에 문제가 발생하지 않도록 해야 함

**엔티티 간에 발생한 일대일(1:1) 관계도 통합 대상**
- 엔티티 합체이자, 넓은 의미에서 엔티티 통합
- 개념 모델링이나 논리 모델링 단계에서 일대일(1:1) 관계를 정확하게 도출하지 않고 엔티티를 합체하는 것은 바람직하지 않음
- e.g. 입고, 출고 데이터
- But 제품의 재고가 현재 존재하는지, 출고됐으면 언제 출고됐는지 등 알아야하는 요건 때문에 분리해 관리하는 게 이득이 없다면 통합
- 통합 방법은 두 가지
  1. 입고, 출고를 개별 인스턴스로 관리
  2. 입출고를 통합한 인스턴스로 관리
     - 입고에 대한 출고만 존재하면 편리하며 성능적으로도 유리
     - But 입고에 대해 출고가 여러 번 발생하면 사용 불가
- 일대일 관계의 두 엔티티를 합체하면 조인이 발생하지 않는다는 장점. 따라서 항상 같이 사용하면 합치는 게 이득

> ‼️ 물리 모델링 단계 이전까지(특히 개념 모델링 단계) 데이터 성격에 따라 1:1 관계를 정확히 관리하는 것이 바람직함. 모델의 가독성 및 확장성 개선 목적

**유니온 구문이 사용된 뷰가 존재하면, 뷰가 사용된 엔티티도 통합 대상**
- 통합된 형태의 조회가 빈번하게 사용된다는 것을 의미하기 때문

**비정규화 과정에서의 엔티티 통합**

### 엔티티 통합하는 기준 (전부 만족)
- 데이터의 성격(주제)가 유사하다
- 식별자가 동일하면서 유사한 속성이 존재한다
- 식별자는 다르지만 기초 속성이 유사하다

### 엔티티 통합하는 기준 (Optional)
- 별개의 요건으로 사용되지 않고 주로 같이 조회된다
- 통합해서 성능 문제를 일으키지 않는다
- 현행 데이터가 존재하면 마이그레이션하는 데 문제가 없다.

---

### 5.4 데이터 오너십
**데이터는 통합 관리돼야 바람직하다.**
- 데이터 자체는 누구의 소유도 될 수 없고, 민감한 데이터는 보안의 문제로 권한을 관리한다.

**엔티티는 업무 영역이나 개발 영역과는 무관하게 주제 영역 모델(ERD)에 존재해야 한다.**
- 엔티티는 데이터의 성격에 따라 가장 유사한 주제 영역 모델에 속하면 된다. (릴레이션의 기초 속성 기준)
- 화면을 개발하는 사람의 업무 영역에만 해당 엔티티를 두어서는 안된다.
- 기초 속성에 의해 모델(ERD) 오너십이 결정
- 서브타입별로 업무 오너십이 결정 (통합 엔티티의 구분 서브타입)






