## 11.1 app 디렉터리의 등장

- Next.js 버전까지는 무언가 페이지 공통 레이아웃을 구성할 수 있는 방법이 `_app`이 유일
- 그런데, `_app`은 루트에 하나만 존재할 수 있었기에, 서로 다른 레이아웃을 구성하기에 부족

```
💡 이러한 레이아웃의 한계를 극복하기 위해 나온 것이 Next.js의 app 레이아웃
```

## 11.2 리액트 서버 컴포넌트

- `서버 컴포넌트` !== `서버 사이드 렌더링`

### 11.2.1 기존 리액트 컴포넌트와 서버 사이드 렌더링의 한계

- **리액트의 모든 컴포넌트는 클라이언트에서 작동**, 브라우저에서 자바스크립트 코드 처리

  ```
  예를 들어, 리액트로 만들어진 페이지를 방문하면
  클라이언트는,
    - 리액트 실행에 필요한 코드를 다운로드
    - 리액트 컴포넌트 트리를 만든 다음
    - DOM을 렌더링
    - 이렇게 만들어진 DOM을 기준으로 하이드레이션 진행
    - 이후 브라우저에서는 상태를 추적
    - 이벤트 핸들러를 DOM에 추가
    - 응답에 따라 렌더링 트리를 변경하기도
  ```

**`🤔 하이드레이션을 진행한다는 건 어떤걸까?`**

> https://ko.react.dev/reference/react-dom/client/hydrateRoot

- 보통 서버에서 렌더링된 HTML을 hydrate한다고 말하는데
- `hydrateRoot(domNode, reactNode)`
  - 첫 번째 인자: 서버에서 렌더링된 DOM 엘리먼트
  - 두 번째 인자: HTML을 렌더링하기 위한 React 노드 (ex. `<App />`)

```
💡 hydration 한다는 것은
   서버에서 렌더링된 DOM을 기반으로, 리액트가 관리할 수 있는 컴포넌트 트리로 변환
```

**`🤔 hydration은 어떻게 동작하나?`**

- 서버에서 렌더링된 DOM 트리를 기반으로, 컴포넌트 트리를 생성하는데
- 커서를 유지하면서 비교를 하고, 새로 생성하는 것이 아니라 재사용해서 `stateNode`를 설정

**`🤔 stateNode는 뭘까?`**

- Fiber 노드가 가지고 있는 정보 중 하나
- 실제 컴포넌트 인스턴스 또는 DOM 노드와의 연결
- 서버에서 렌더링된 `<div>Hi<div>` 요소에 대해
  - **리액트는 이 DOM 요소를 `stateNode`로 설정하고**
  - 이를 컴포넌트 트리와 연결
  - 리액트는 `stateNode`를 통해 DOM 요소를 관리
  - 이후에 상태 업데이트나 이벤트 처리 등을 동적으로 가능하도록

```
💡 따라서, 새로운 DOM 트리를 생성하지 않고, 기존 DOM 노드를 재사용하여 stateNode 설정하는 것
```

**`😲 이런 것들까지 서버에서 이뤄질 수 있다면?`**

1. 서버에서는 해당 라이브러리를 실행한 결과와 컴포넌트 렌더링 결과물만 클라이언트에게 제공
   - 클라이언트가 다운로드 및 실행 X
2. 클라이언트에서 직접 백엔드에 접근해 원하는 데이터 가져오기
   - 백엔드에 접근할 수 있는 단계가 하나 줄어든 것
3. 연쇄적으로 발생하는 클라이언트와 서버의 요청을 서버에서 처리
   - 데이터를 불러오고 컴포넌트를 렌더링하는 것이 모두 서버에서
   - 클라이언트에서 서버로 요청함으로써 발생하는 지연 감소
   - 클라이언트에서 반복적으로 요청을 수행할 필요도 X

### 11.2.2 서버 컴포넌트란?

## Reference

- [리액트 내부 동작 원리 27 — Hydration](https://medium.com/@sanoopark/%EB%A6%AC%EC%95%A1%ED%8A%B8-%EB%82%B4%EB%B6%80-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC-27-hydration-058a1af9c713)
- [React 파이버 아키텍처 분석](https://d2.naver.com/helloworld/2690975)
