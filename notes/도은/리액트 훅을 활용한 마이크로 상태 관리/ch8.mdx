- `Jotai`ëŠ” ì „ì—­ ìƒíƒœë¥¼ ìœ„í•œ ì‘ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬
- ì•„í†°: ìƒíƒœì˜ ì‘ì€ ì¡°ê°
- `Zustand`ì™€ ë‹¬ë¦¬ ì»´í¬ë„ŒíŠ¸ ìƒíƒœë¥¼ ì‚¬ìš©
- `Zustand`ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë¶ˆë³€ ìƒíƒœ ëª¨ë¸
- ë‚´ë¶€ì ìœ¼ë¡œ `Context`ë¥¼ ì‚¬ìš©
- ì•„í†° ìì²´ëŠ” ê°’ì„ ê°€ì§€ì§€ ì•Šê¸° ë•Œë¬¸ì— ëª¨ë“ˆ ìƒíƒœì™€ ë‹¬ë¦¬ ì•„í†° ì¬ì‚¬ìš© ê°€ëŠ¥

### Jotai ì´í•´í•˜ê¸°

- `Jotai`ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë‘ ê°€ì§€ ì´ì 
  - êµ¬ë¬¸ ë‹¨ìˆœì„±
  - ë™ì  ì•„í†° ìƒì„±

#### 1. êµ¬ë¬¸ ë‹¨ìˆœì„±

```jsx
const [text, setText] = useAtom(textAtom);
```

- í•œ ì¤„ì˜ ì•„í†° ì •ì˜ë§Œ ì¶”ê°€í•˜ë©´ ë

#### 2. ë™ì  ì•„í†° ìƒì„±

- ì•„í†°ì€ ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ìƒëª…ì£¼ê¸°ì—ì„œ ìƒì„±ë˜ê±°ë‚˜ ì†Œë©¸ ê°€ëŠ¥

**`ğŸ¤” ì „ì—­ìƒíƒœì¸ë° ìƒëª…ì£¼ê¸°ì—ì„œ ìƒì„±ë˜ê±°ë‚˜ ì†Œë©¸ ê°€ëŠ¥í•˜ë‹¤ê³ ?`**

- `useAtom` í›…ì„ ì‚¬ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ì•„í†°ì„ ì„ ì–¸í•˜ë©´, ì»´í¬ë„ŒíŠ¸ê°€ ë Œë”ë§ë  ë•Œ ì´ ì•„í†°ì´ ìƒì„±
- ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë˜ë©´, í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ë˜ ì•„í†°ë„ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šê²Œ ë˜ì–´ ì†Œë©¸

### ë Œë”ë§ ìµœì í™”

- **ì•„í†°ì€ ë¦¬ë Œë”ë§ì„ ê°ì§€í•˜ëŠ” ë‹¨ìœ„**
- ì•„í†°ì„ ì›ì‹œ ê°’ì²˜ëŸ¼ ì›í•˜ëŠ” ë§Œí¼ ì‘ê²Œ ë§Œë“¤ì–´ ë¦¬ë Œë”ë§ì„ ì œì–´í•  ìˆ˜ ìˆë‹¤.
  - ì¡°ì‘í•´ì•¼ í•  ì•„í†°ì´ ë§ì•„ì§ˆ ìˆ˜ ìˆìŒì„ ì£¼ì˜
- ê¸°ì¡´ ì•„í†°ìœ¼ë¡œ ë˜ ë‹¤ë¥¸ ì•„í†°ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

  ```jsx
  const personAtom = atom((get) => ({
    firstName: get(firstNameAtom),
    lastName: get(lastNameAtom),
    age: get(ageAtom),
  }));
  ```

  ì†ì„± ì¤‘ í•˜ë‚˜ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ê°±ì‹  â†’ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§? ğŸ˜¨

- ì•„í†°ì„ ì¬ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.

  ```jsx
  const Counter = ({ countAtom }) => {
    const [count, setCount] = useAtom(countAtom);
    const inc = () => setCount((c) => c + 1);
    return (
      <>
        {count} <button onClick={inc}>+1</button>
      </>
    );
  };
  ```

### Jotaiê°€ ì•„í†° ê°’ì„ ì €ì¥í•˜ëŠ” ë°©ì‹ ì´í•´í•˜ê¸°

```jsx
const countAtom = atom(0);
```

- `countAtom`ì€ ê°’ ë˜ëŠ” ê°±ì‹  í•¨ìˆ˜ë¡œ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ê°’ì„ ê°€ì§„ ì›ì‹œ ì•„í†°
- ì›ì‹œ ì•„í†°ì€ `useState`ì²˜ëŸ¼ ë™ì‘í•˜ë„ë¡ ì„¤ê³„
- â­ï¸ `countAtom`ê³¼ ê°™ì€ **ì•„í†° êµ¬ì„±ì´ ì§ì ‘ í•´ë‹¹ ê°’ì„ ê°€ì§€ì§€ ì•ŠëŠ”ë‹¤.**
  - ì•„í†° ê°’ì„ ì €ì¥í•˜ëŠ” `store`ê°€ ë”°ë¡œ ì¡´ì¬
  - `store`ì—ëŠ” **í‚¤ê°€ ì•„í†° êµ¬ì„± ê°ì²´**, **ê°’ì´ ì•„í†° ê°’**ì¸ WeakMap ê°ì²´ ì¡´ì¬
- `useAtom`ì„ ì‚¬ìš©í•˜ë©´, ëª¨ë“ˆ ìˆ˜ì¤€ì—ì„œ ì •ì˜ëœ ê¸°ë³¸ store ì‚¬ìš©

### ë°°ì—´ êµ¬ì¡° ì¶”ê°€í•˜ê¸°

- ë¦¬ì•¡íŠ¸ì—ì„œëŠ” ë°°ì—´ êµ¬ì¡°ë¡œ ì´ë¤„ì§„ ì»´í¬ë„ŒíŠ¸ë¥¼ ë Œë”ë§í•  ë•Œ, `key` ì†ì„±ì„ ì „ë‹¬í•´ì•¼ í•œë‹¤.

```jsx
const todosAtom = atom([]);

const TodoList = () => {
  const [todos, setTodos] = useAtom(todosAtom);

  const removeAtom = useCallback((id) => setTodos((prev) => prev.filter((item) => item.id !== id)), [setTodos]);
  const toggleAtom = useCallback((id) =>
    setTodos((prev) => prev.map((item) => (item.id === id ? { ...item, done: !item.done } : item)), [setTodos]),
  );
};
```

- ğŸ˜¨ ë‹¨ì¼ ìš”ì†Œë¥¼ ë³€ê²½í•˜ê¸° ìœ„í•´ `todos` ë°°ì—´ ì „ì²´ë¥¼ ê°±ì‹ í•´ì•¼ í•œë‹¤.
- ğŸ˜¨ `toggleTodo` í•¨ìˆ˜ì—ì„œëŠ” ëª¨ë“  ìš”ì†Œë¥¼ ìˆœíšŒí•˜ë©° í•˜ë‚˜ì˜ ìš”ì†Œë§Œ ë³€ê²½í•œë‹¤.

#### Atoms-in-Atom

```jsx
const TodoItem = ({ todoAtom, remove }) => {
  const [todo, setTodo] = useAtom(todoAtom);
  return (
    <div>
      <input type="checkbox" checked={todo.done} onChange={() => setTodo((prev) => ({ ...prev, done: !prev.done }))} />
    </div>
  );
};
```

```jsx
const TodoList = () => {
  const [todoAtoms, setTodoAtoms] = useAtom(todoAtomsAtom);
  const remove = useCallback(
    (todoAtom) => setTodoAtoms((prev) => prev.filter((item) => item !== todoAtom)),
    [setTodoAtoms],
  );

  return (
    <div>
      {todoAtoms.map((todoAtom) => (
        <TodoItem key={`${todoAtom}`} todoAtom={todoAtom} remove={remove} />
      ))}
    </div>
  );
};
```

- ì•„í†° êµ¬ì„±ì€ ë¬¸ìì—´ë¡œ í‰ê°€ë  ë•Œ ìœ ì¼í•œ ì‹ë³„ìë¥¼ ë°˜í™˜
- `Atoms-in-Atom` â†’ toggleTodoë¥¼ í†µí•´ ê°±ì‹  â†’ todoAtomsAtomì€ ë³€ê²½ X

`Atoms-in-Atom` íŒ¨í„´ì„ ì‚¬ìš©í–ˆì„ ë•Œì˜ ì°¨ì´ì ì„ ë‹¤ìŒê³¼ ê°™ì´ ìš”ì•½

- ë°°ì—´ ì•„í†°ì€ ì•„í†°ì´ ìš”ì†Œì¸ ë°°ì—´ì„ ë³´ê´€í•˜ëŠ” ë° ì‚¬ìš©
- ë°°ì—´ì— ìƒˆë¡œìš´ ìš”ì†Œë¥¼ ì¶”ê°€í•˜ë ¤ë©´ ìƒˆë¡œìš´ ì•„í†°ì„ ìƒì„±í•´ì„œ ì¶”ê°€í•´ì•¼ í•œë‹¤.
- ì•„í†° êµ¬ì„±ì€ ë¬¸ìì—´ë¡œ í‰ê°€í•  ìˆ˜ ìˆìœ¼ë©° UIDë¥¼ ë°˜í™˜
- ìš”ì†Œë¥¼ ë Œë”ë§í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ëŠ” ê° ì»´í¬ë„ŒíŠ¸ì—ì„œ ì•„í†° ìš”ì†Œë¥¼ ì‚¬ìš©

  - ì´ë ‡ê²Œ í•˜ë©´ ìš”ì†Œì˜ ê°’ì„ ì‰½ê²Œ ë³€ê²½í•  ìˆ˜ ìˆê³  ë¦¬ë Œë”ë§ì„ ìì—°ìŠ¤ëŸ½ê²Œ í”¼í•  ìˆ˜ ìˆë‹¤.

### Jotaiì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ ì‚¬ìš©í•˜ê¸°

#### 1. ì•„í†°ì˜ write í•¨ìˆ˜ ì •ì˜í•˜ê¸°

```jsx
const countAtom = atom(0);

const doubledCountAtom = atom((get) => get(countAtom) * 2);
```

- `countAtom`: ì›ì‹œ ì•„í†° â†’ ì“°ê¸° ê°€ëŠ¥
- `doubledCountAtom`: `countAtom`ì— ì™„ì „í•˜ê²Œ ì˜ì¡´ â†’ ì½ê¸° ì „ìš©
- ì“°ê¸° ê°€ëŠ¥í•œ íŒŒìƒ ì•„í†°ì„ ìƒì„±í•˜ê¸° ìœ„í•´ì„œëŠ” write í•¨ìˆ˜ë¥¼ ë°›ì•„ ì‚¬ìš© ê°€ëŠ¥
  ```jsx
  const doubledCountAtom = atom(
    (get) => get(countAtom) * 2,
    (get, set, arg) => set(countAtom, arg / 2), // ë°›ì€ ê°’ / 2 í•˜ì—¬ setí•œë‹¤.
  );
  ```

#### 2. ì•¡ì…˜ ì•„í†° ì‚¬ìš©í•˜ê¸°

- ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ì½”ë“œë¥¼ ìœ„í•´ í•¨ìˆ˜ ë˜ëŠ” í•¨ìˆ˜ ì§‘í•©ì„ ë§Œë“œëŠ” ê²½ìš°ê°€ ìˆë‹¤.
  - ì´ëŸ¬í•œ ëª©ì ìœ¼ë¡œ ì•„í†°ì„ ì‚¬ìš© ê°€ëŠ¥ â†’ ì•¡ì…˜ ì•„í†°

```jsx
const countAtom = count(0);

// ì“°ê¸° ì „ìš© ì•„í†°
const incrementCountAtom = atom(null, (get, set, arg) => set(countAtom, (c) => c + 1));
```

#### 3. ì•„í†°ì˜ onMount ì˜µì…˜ ì´í•´í•˜ê¸°

- ì•„í†°ì´ ì‚¬ìš©ë˜ê¸° ì‹œì‘í•  ë•Œ íŠ¹ì • ë¡œì§ì„ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆë‹¤.
- ë¦¬ì•¡íŠ¸ ë‹¨ì—ì„œ `useEffect` í›…ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆì§€ë§Œ,
  - ì•„í†° ìˆ˜ì¤€ì—ì„œ `Jotai`ì˜ `onMount` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ ê°€ëŠ¥

```jsx
const countAtom = atom(0);
countAtom.onMount = (setCount) => {
  console.log('count atom ì‚¬ìš©ì„ ì‹œì‘í•©ë‹ˆë‹¤');
  const onUnmount = () => {
    console.log('count atom ì‚¬ìš©ì´ ëë‚¬ìŠµë‹ˆë‹¤');
  };
  return onUnmount;
};
```

#### 4. jotai/utils ë²ˆë“¤ ì†Œê°œí•˜ê¸°

- `Jotai`ëŠ” ë‹¤ì–‘í•œ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ê°€ í¬í•¨ëœ `jotai/utils`ë¼ëŠ” ë³„ë„ì˜ ë²ˆë“¤ì„ ì œê³µ

**`ğŸ¤” ê³µì‹ë¬¸ì„œ ëœ¯ì–´ë¨¹ì–´ë³´ê¸°`**

> https://jotai.org/

##### (1) Server side rendering

```jsx
export default function IndexPage({ count, framework }: IndexPageProps) {
  useHydrateAtoms([
    [countAtom, count],
    [frameworkAtom, framework],
  ]);

  return (
    <div>
      <Link href="/about">About</Link>
      <h1>Index Page</h1>
      <Counter />
      <Framework />
    </div>
  );
}

export function getServerSideProps() {
  return { props: { count: 42, framework: 'Next.js' } };
}
```

ìœ„ì™€ ê°™ì´ ì„œë²„ ì‚¬ì´ë“œì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ hydrate ì‹œì¼œì„œ atom ê°’ì— ì£¼ì…í•´ì¤„ ìˆ˜ ìˆë‹¤.

##### (2) Async

```jsx
import { loadable } from "jotai/utils"

const asyncAtom = loadable(atom(async (get) => ...))
// Suspenseë¡œ ê°ì‹¸ì„œ ë¡œë”©ì²˜ë¦¬í•  í•„ìš”ì—†ì´ atomìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥
const Component = () => {
  const [value] = useAtom(loadableAtom)
  if (value.state === 'hasError') return <Text>{value.error}</Text>
  if (value.state === 'loading') {
    return <Text>Loading...</Text>
  }
  // ì„±ê³µë¡œì§
  console.log(value.data)
  return <Text>Value: {value.data}</Text>
}
```

ìœ„ì™€ ê°™ì´ ë¹„ë™ê¸°ë¡œ atom ê°’ì„ ê´€ë¦¬í•´ì•¼ í•œë‹¤ë©´, atom ìì²´ì—ì„œ ìƒíƒœ ì²˜ë¦¬ë¥¼ ì œê³µí•´ì¤€ë‹¤.

ğŸ¤” ê·¼ë° ë¹„ë™ê¸°ë¡œ atomê°’ì„ ê´€ë¦¬í•´ì•¼í•  ì¼ì´ ë§ì„ë ¤ë‚˜. . ?

##### (3) Select

```jsx
const defaultPerson = {
  name: {
    first: 'Jane',
    last: 'Doe',
  },
  birth: {
    year: 2000,
    month: 'Jan',
    day: 1,
    time: {
      hour: 1,
      minute: 1,
    },
  },
};

const personAtom = atom(defaultPerson);

const nameAtom = selectAtom(personAtom, (person) => person.name);
```

ë³´í†µ jotaië¥¼ ì‚¬ìš©í•  ë•Œ ì‘ì€ atomì„ ë§Œë“¤ì–´ í•„ìš”ì— ë”°ë¼ ë­‰ì³ë‘ëŠ” ê²ƒ ê°™ì€ë°, `selectAtom`ì„ ì‚¬ìš©í•˜ë©´ ê·¸ ë°˜ëŒ€ë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•  ê²ƒ ê°™ë‹¤.
