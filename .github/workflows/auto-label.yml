name: Auto Label PR

on:
  pull_request:
    types: [opened, edited]

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.x'

      - name: Install dependencies
        run: |
          pip install fuzzywuzzy

      - name: Determine label
        id: label
        run: |
          import os
          import sys
          from fuzzywuzzy import process

          # PR 제목 가져오기
          pr_title = os.getenv('GITHUB_EVENT_PULL_REQUEST_TITLE')
          # 사용할 label 목록
          labels = ["bug", "enhancement", "documentation", "question"]

          # 가장 유사한 label 찾기
          best_match = process.extractOne(pr_title, labels)
          print(f"Best match label: {best_match[0]}")

          # 출력
          print(f"::set-output name=label::{best_match[0]}")

      - name: Add label to PR
        uses: actions/github-script@v4
        with:
          script: |
            const label = '${{ steps.label.outputs.label }}';
            const { context } = require('@actions/github');
            await github.issues.addLabels({
              ...context.repo,
              issue_number: context.payload.pull_request.number,
              labels: [label]
            });
